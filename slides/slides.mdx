export { default as theme } from './theme'
import GridLayout from './components/GridLayout'
import Iframe from './components/Iframe'
import Exercise from './components/Exercise'
import Title from './components/Title'
import { Appear, Head } from 'mdx-deck'
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome'
import {
  faGithub,
  faTwitter,
  faFacebook,
  faInstagram,
} from '@fortawesome/free-brands-svg-icons'
import {
  faLightbulb,
  faMobileAlt,
  faCubes,
  faFish,
} from '@fortawesome/free-solid-svg-icons'
import { Timeline, TimelineEvent } from './components/Timeline'

<Head>
  <title>React Hooks Workshop</title>
  <meta name="twitter:site" content="@neoziro" />
  <meta name="twitter:title" content="React Hooks Workshop" />
  <meta
    name="twitter:description"
    content="React Hooks Workshop by Greg BergÃ©"
  />
</Head>

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,dpr_2/v1552399812/logos/smooth-academy.svg"
  alt="Smooth Academy"
  style={{ width: '50%' }}
/>

<h1>React Advanced<br />Workshop</h1>

---

<img
  src="https://res.cloudinary.com/smooth/image/upload/w_300,h_300,dpr_2/v1551174170/avatars/greg-berge.jpg"
  alt="Greg BergÃ©"
  style={{ width: '50%', maxWidth: 300, borderRadius: '50%' }}
/>

### Greg BergÃ©

DÃ©veloppeur full-stack JavaScript.<br />
Co-fondateur de Smooth Code

<div>
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faGithub} /> @neoziro
  </a>
  {' | '}
  <a style={{ textDecoration: 'none' }} href="https://github.com/neoziro">
    <FontAwesomeIcon icon={faTwitter} /> @neoziro
  </a>
</div>

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/160/square_480/EGH_ReactBeginners.png" />
  <Title.Text>State of React</Title.Text>
</Title>

---

## Historique

<Timeline>
  <Appear>
    <TimelineEvent
      title="Jordan Walke crÃ©e React (Reason)"
      createdAt="2010"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faLightbulb} />
      }
    />
    <TimelineEvent
      title="Feed Facebook avec React"
      createdAt="2011"
      iconColor="#3C5A99"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faFacebook} />
      }
    />
    <TimelineEvent
      title="Instagram web en React"
      createdAt="2012"
      iconColor="#E1306C"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faInstagram} />
      }
    />
    <TimelineEvent
      title="React Native Open Source"
      createdAt="2015"
      iconColor="#005068"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faMobileAlt} />
      }
    />
    <TimelineEvent
      title="React Fiber"
      createdAt="2017"
      icon={
        <FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faCubes} />
      }
    />
    <TimelineEvent
      title="React Hooks"
      createdAt="2019"
      icon={<FontAwesomeIcon style={{ width: 20, height: 20 }} icon={faFish} />}
    />
  </Appear>
</Timeline>

---

## React vs Vue vs Angular

<Iframe src="https://npmcharts.com/compare/react,@angular/core,vue?minimal=true&interval=7" />

---

## Ã€ retenir

> ğŸ‘‰ React est incontournable

> ğŸ‘‰ Vue est en croissance

> ğŸ‘‰ Angular est sur le dÃ©clin

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/228/full/EGH_ReactStorybook_Final.png" />
  <Title.Text>Glossaire</Title.Text>
</Title>

---

## Fiber ?

- RÃ©Ã©criture du coeur de React (v16)
- Permet la crÃ©ation de nouvelles features
- Hooks, Suspense, Concurrent Mode...

> ğŸ‘‰ Aucun impact pour le dÃ©veloppeur

---

## Hooks ?

- Nouvelle API de crÃ©ation de composants
- Sortie le 6 fÃ©vrier 2019 (v16.8)

> ğŸ‘‰ Simplification du dÃ©veloppement

---

## Concurrent Mode ?

- Rendu non bloquant
- Permet d'optimiser les performances
- Mode strict requis
- Sortie Ã  venir (Q2 2019)

> ğŸ‘‰ Application plus fluide et performante

---

## Suspense ?

- Solution pour gÃ©rer le data-fetching
- Sortie Ã  venir (mid 2019)

> ğŸ‘‰ Data-fetching simplifiÃ©

---

## SSR ?

- Server Side Rendering
- Aussi appelÃ© "Universal Web App"
- Le HTML est gÃ©nÃ©rÃ©e cÃ´tÃ© serveur
- Inverse de CSR (Client Side Rendering)

> ğŸ‘‰ Le seul use-case est le SEO

---

## Progressive Web App ?

- Application qui fonctionne en offline

> ğŸ‘‰ C'est un must-have, rarement requis

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/027/square_480/course_image.png" />
  <Title.Text>Primitives React</Title.Text>
</Title>

---

## JSX

```js
<div className="foo" />
```

> ğŸ‘‰ Extension au langage JavaScript

---

## Element

```js
const element = <div />
```

> ğŸ‘‰ Une instance de composant React

---

## Composant

```js
function Div(props) {
  return <div />
}
```

`props => element`

> ğŸ‘‰ Majuscule obligatoire !

---

## Qu'est-ce qu'une fonction ?

<img
  style={{ maxHeight: '80vh', width: '80%' }}
  src="https://pbs.twimg.com/media/D1j5S_wWsAc3lPB.jpg:large"
/>

---

export default GridLayout

## Syntaxe des fonctions

```js
// Named function
function fn(props) {
  return props.foo
}
```

```js
// Named function + destructuring
function fn({ foo }) {
  return foo
}
```

```js
// Arrow function
const fn = props => {
  return props.foo
}
```

```js
// Arrow function + destructuring
const fn = ({ foo }) => {
  return foo
}
```

```js
// Short Arrow function + destructuring
const fn = props => props.foo
```

```js
// Short Arrow function + destructuring
const fn = ({ foo }) => foo
```

---

## Ã€ retenir

> ğŸ‘‰ JSX : extension de JavaScript

> ğŸ‘‰ Element : morceau de JSX

> ğŸ‘‰ Composant : fonction qui renvoie un Ã©lÃ©ment

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/085/square_480/EGH_ImageGallery_Final.png" />
  <Title.Text>Lifecycle</Title.Text>
</Title>

---

## Phases

- Mount
- Update
- Unmount

---

## Mount

- Le composant est ajoutÃ© dans l'arbre React

---

## Update

- Le composant est mis Ã  jour
- DÃ©clenchÃ© par au-dessus (les props)
- Ou par lui-mÃªme (le state)

---

## Unmount

- Le composant est retirÃ© de l'arbre React

---

## Diagramme interactif

<Iframe src="http://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/" />

---

## Ã€ retenir

> ğŸ‘‰ Trois phases : Mount, Update, Unmount

> ğŸ‘‰ Le rendu est dÃ©clenchÃ© lors du Mount et de l'Update

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/014/square_480/course_image.png" />
  <Title.Text>DÃ©marrer avec React</Title.Text>
</Title>

---

## Create React App

- Moyen le plus rapide pour dÃ©marrer
- Maintenu par la team React
- SVGR inside âœ¨ğŸ˜

---

## Philosophie

- Zero-config
- Focus sur React
- Scalable (Ã©jection possible)

---

## Under the hood

- ğŸ“¦ Bundler (webpack)
- ğŸŒ Dev server (webpack)
- ğŸ¤¯ Transpiler (Babel)
- ğŸ‘®â€â™‚ï¸ Linter (ESLint)
- âœ¨ CSS Autoprefixer
- ğŸƒ Test runner (Jest)
- ğŸ¦ Gestion des SVG (SVGR)

---

## Ã€ retenir

> ğŸ‘‰ Projet React â†’ create-react-app

---

<Exercise num={1} title="Create React App" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/263/square_480/EGH_SimplifyHooks_Final.png" />
  <Title.Text>React Hooks</Title.Text>
</Title>

---

## Introduction

<iframe
  style={{ width: '80vw', height: '50vh', overflow: 'hidden' }}
  src="https://www.youtube.com/embed/dpw9EHDh2bM"
  frameborder="0"
  allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
  allowfullscreen
/>

PrÃ©sentÃ© par Dan Abramov et Sophie Alpert lors de la React Conf 2018.

---

## No breaking change !

- Les classes restent supportÃ©es
- Tout est 100% rÃ©trocompatible
- Pas imposÃ©, mais recommandÃ© ğŸ˜

---

## Motivation

- Partage de logique entre composants
- Alternatives aux HOCs et aux render props
- API plus simple Ã  aprÃ©hender

---

## Ã€ retenir

> ğŸ‘‰ Migrer son code progressivement ğŸ¤—

> ğŸ‘‰ Ne pas se forcer Ã  les utiliser ğŸ¤¯

---

## Qu'est-ce quâ€™un Hook ğŸ£ ?

<dl>
  <dt>React Hook</dt>
  <dd>
    <em>/É¹iËËˆÃ¦kt/ /hÊŠk/</em> â€¢ Fonction spÃ©ciale permettant de se brancher sur
    des features React Ã  l'intÃ©rieur d'un composant.
  </dd>
</dl>

---

## Hooks basics ğŸ˜‡

- `useState`
- `useEffect`
- `useContext`

---

## Hooks avancÃ©s ğŸ˜ˆ

- `useReducer`
- `useCallBack`
- `useMemo`
- `useRef`
- `useImperativeHandle`
- `useLayoutEffect`
- `useDebugValue`

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/194/square_480/EGH_ReactMobileNav_Final.png" />
  <Title.Text>Rules of Hooks</Title.Text>
</Title>

---

<h2>Uniquement dans les fonctions,<br />tu les utiliseras.</h2>

```js
function Example(props) {
  // âœ… Vous pouvez utiliser les hooks ici
  return <div />
}
```

> Pas de Hooks dans les classes.

---

<h2>Au niveau le plus haut,<br />tu te positionneras.</h2>

```js
function Example(props) {
  if (props.disabled) {
    // ğŸš« Vous ne pouvez pas utiliser les hooks ici
  }
  return <div />
}
```

> Pas de conditions, boucles ou autre...

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/114/square_480/EGH_ReactRecompose_Final.png" />
  <Title.Text>State Management</Title.Text>
</Title>

---

## Hook Counter

```js
import React, { useState } from 'react'

function Example() {
  // "count" est le state, "setCount" est la fonction permettant de modifier le state
  // "0" est la valeur initiale
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Class Counter

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Le state nâ€™est pas mergÃ©

```js
const [coords, setCoords] = useState({ x: 10, y: 20 })
setCoords({ x: 15 })
// Les nouvelles coordonnÃ©es seront { x: 15 } et pas { x: 10, y: 15 }
```

---

## DÃ©clarer plusieurs Ã©tats

```js
function ExampleWithManyStates() {
  // DÃ©clarer plusieurs state dans la mÃªme fonction !
  const [age, setAge] = useState(42)
  const [fruit, setFruit] = useState('banana')
  const [todos, setTodos] = useState([{ text: 'Learn Hooks' }])
  // ...
}
```

> ğŸ‘‰ Ne pas hÃ©siter Ã  dÃ©composer les states

---

## Comment Ã§a marche ?

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

- `count` est Ã  0 au montage
- Au clic sur le bouton, le state est mis Ã  jour
- Le composant est re-rendu, `count` est Ã  1

---

## Update

```js
const [count, setCount] = useState(0)
// On peut passer une valeur directement
setCount(10)
// Si on utilise le state prÃ©cÃ©dent, on passe une fonction
setCount(previousCount => previousCount + 1)
```

> ğŸ‘‰ Toujours utiliser une fonction si on part du state prÃ©cÃ©dent

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/197/square_480/Manage_React_Form.png" />
  <Title.Text>Controlled VS uncontrolled</Title.Text>
</Title>

---

## Uncontrolled components

```js
function Example() {
  // Input non contrÃ´lÃ©, il gÃ¨re son state seul
  return <input defaultValue="initial value" />
}
```

---

## Controlled components

```js
function Example() {
  const [value, setValue] = useState('')
  // Input contrÃ´lÃ©, le state est hors du composant "input"
  return (
    <input value={value} onChange={event => setValue(event.target.value)} />
  )
}
```

---

## Controlled to Uncontrolled

```js
function ControlledInput({ defaultValue, ...props }) {
  const [value, setValue] = useState(defaultValue)
  return (
    <input
      value={value}
      onChange={event => setValue(event.target.value)}
      {...props}
    />
  )
}
```

> ğŸ‘‰ Il est possible de crÃ©er un composant non-contrÃ´lÃ© Ã  partir d'un composant contrÃ´lÃ©, mais pas l'inverse.

---

## Ã€ retenir

> ğŸ‘‰ Toujours privilÃ©gier les composants contrÃ´lÃ©s ğŸ‘®â€â™‚ï¸

---

<Exercise num={2} title="Search Field" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/193/square_480/EGH_OptimisticReact_Final.png" />
  <Title.Text>Effects</Title.Text>
</Title>

---

# Qu'est-ce qu'un effet âœ¨ ?

---

<dl>
  <dt>Effet</dt>
  <dd>
    <em>\e.fÉ›\</em> â€¢ Effet de bord sous forme de fonction dÃ©clenchÃ© aprÃ¨s le
    rendu du composant.
  </dd>
</dl>

---

## Page Title

```js
import React, { useState, useEffect } from 'react'
function Example() {
  const [count, setCount] = useState(0)

  // Similar to componentDidMount and componentDidUpdate:
  useEffect(() => {
    // Update the document title using the browser API
    document.title = 'You clicked ' + count + ' times'
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>Click me</button>
    </div>
  )
}
```

---

## Ã‰quivalent

```js
class Example extends React.Component {
  constructor(props) {
    super(props)
    this.state = {
      count: 0,
    }
  }

  componentDidMount() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  componentDidUpdate() {
    document.title = 'You clicked ' + this.state.count + ' times'
  }

  render() {
    return (
      <div>
        <p>You clicked {this.state.count} times</p>
        <button onClick={() => this.setState({ count: this.state.count + 1 })}>
          Click me
        </button>
      </div>
    )
  }
}
```

---

## Penser "effect"

- Quel est lâ€™effet de bord ?
- Comment dois-je le nettoyer ?
- Quâ€™est-ce qui impact cet effet ?

---

## Nettoyage

```js
function ClickSpy() {
  useEffect(() => {
    function handleClick() {
      alert('clicked')
    }
    document.addEventListener('click', handleClick)
    // La fonction retournÃ©e par l'effet est le "clean"
    return () => {
      document.removeEventListener('click', handleClick)
    }
  })

  return null
}
```

---

## Lifecycle

- Mount
  - Run effect
- Update
  - Clean effect
  - Run effect
- Unmount
  - Clean effect

---

## SÃ©paration des responsabilitÃ©s

```js
useEffect(() => {
  document.title = 'My title'
})
useEffect(() => {
  pingMyApi()
})
```

> ğŸ‘‰ Un effet â†’ Une responsabilitÃ©

---

## DÃ©pendances

```js
function PageTitle({ title }) {
  useEffect(() => {
    document.title = title
  }, [title]) // Cet effet sera dÃ©clenchÃ© que si "title" change
  return null
}
```

> ğŸ‘‰ Les dÃ©pendances sont les variables externes utilisÃ©es dans l'effet

---

## Montage uniquement

```js
function MountSpy() {
  useEffect(() => {
    console.log('Mount')
  }, [])
  return null
}
```

> ğŸ‘‰ Pas de dÃ©pendances, donc uniquement au montage !

---

<Exercise num={3} title="Data Fetching" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/264/square_480/EGH_ReactHooks_Final_%281%29.png" />
  <Title.Text>Custom Hooks</Title.Text>
</Title>

---

## Composition de Hooks

```js
function App() {
  const [query, setQuery] = useState('Lord of the Rings')
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  /* ... */
}
```

---

## Extraire notre Hook

```js
function useMovieSearch(query) {
  const [movies, setMovies] = useState(null)

  useEffect(() => {
    axios
      .get('https://api.themoviedb.org/3/search/movie', {
        params: {
          api_key: 'c5742978852b8f695a61e22a33a8196c',
          query,
        },
      })
      .then(res => {
        setMovies(res.data.results)
      })
  }, [query])

  return movies
}
```

---

## Rules of Hooks

- Tous les hooks doivent Ãªtre au premier niveau
- Un custom hook est prÃ©fixÃ© par `use`
- Une seule reponsabilitÃ© par Hook

---

<Exercise num={4} title="Custom Hooks" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/267/full/EGH_ReduxStateADT_Final.png" />
  <Title.Text>Error Boundaries</Title.Text>
</Title>

---

## Utilisation

```js
<ErrorBoundary>
  <MyWidget />
</ErrorBoundary>
```

> ğŸ‘‰ Comparable Ã  un try / catch

---

## ImplÃ©mentation

```js
import React, { Component } from 'react'

export default class Catch extends Component {
  // CrÃ©ation du state initial
  state = { hasError: false }

  static getDerivedStateFromError(error) {
    // Mise Ã  jour du state, au prochain rendu, nous saurons qu'une erreur a Ã©tÃ© catchÃ©e
    return { hasError: true }
  }

  render() {
    if (this.state.hasError) {
      // Affichage du fallback de notre choix
      return <h1>Something went wrong.</h1>
    }

    return this.props.children
  }
}
```

---

## Ã€ retenir

> ğŸ‘‰ Mettre des boundaries aux endroits stratÃ©gique

---

<Exercise num={5} title="Error Handling" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/267/full/EGH_ReduxStateADT_Final.png" />
  <Title.Text>
    Error Boundaries
    <br />
    The Limits
  </Title.Text>
</Title>

---

## Prenons un Hook

```js
function useCounter() {
  const [count, setCount] = useState(0)

  useEffect(() => {
    const interval = setInterval(() => setCount(count => count + 1), 1000)
    return () => clearInterval(interval)
  }, [])

  return count
}
```

---

## Dans un composant...

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Que se passe-t-il ?

- A chaque tick de l'interval, `setCount` est appelÃ©
- Un nouveau state est gÃ©nÃ©rÃ©
- Le composant `Example` est re-rendu

---

## Pauvre `OtherStuff`, il n'a rien demandÃ© !

```js
function Example() {
  const count = useCounter()

  return (
    <div>
      {/* OtherStuff va Ãªtre re-rendu pourtant il nâ€™utilise pas le compteur */}
      <OtherStuff />
      <div>{count}</div>
    </div>
  )
}
```

---

## Et si `useCounter` Ã©met une erreur ?

- Lâ€™erreur est Ã©mise par le composant qui contient le Hook
- `Example` est donc l'Ã©metteur de lâ€™erreur

---

# Comment localiser une logique ?

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/166/square_480/EGH_ReactAdvPatterns2_Final.png" />
  <Title.Text>Render props</Title.Text>
</Title>

---

## ImplÃ©mentation

```js
function Counter({ children }) {
  const count = useCounter()
  // `children` est habituellement un ou plusieurs Ã©lÃ©ment
  // ici ce sera une fonction, la "render prop" !
  return children(count)
}
```

---

## Utilisation

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* On passe une fonction en `children` */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## Ce qui a changÃ©

```js
function Example() {
  return (
    <div>
      {/* Example, ne se re-rend plus, OtherStuff n'est donc pas re-rendu */}
      <OtherStuff />
      {/* Le compteur se re-rend et appelle la fonction "children" */}
      <Counter>{count => <div>{count}</div>}</Counter>
    </div>
  )
}
```

---

## I believe I can catch!

```js
function Example() {
  return (
    <div>
      <OtherStuff />
      {/* Je peux placer une Error Boundary autour de mon composant "Counter" */}
      <Catch>
        <Counter>{count => <div>{count}</div>}</Counter>
      </Catch>
    </div>
  )
}
```

---

## Ã€ retenir

> ğŸ‘‰ Les hooks ne remplacent pas les render props

> ğŸ‘‰ Les render props permettent une isolation du rendu

> ğŸ‘‰ Elle permettent une gestion fine des erreurs

---

<Exercise num={6} title="Render props" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/114/square_480/EGH_ReactRecompose_Final.png" />
  <Title.Text>Advanced State Management</Title.Text>
</Title>

---

## La gestion du state, câ€™est compliquÃ©

```js
function Example() {
  const [count, setCount] = useState(0)

  return (
    <div>
      <button onClick={() => setCount(count => count + 1)}>Increment</button>
      <button onClick={() => setCount(count => count - 1)}>Decrement</button>
    </div>
  )
}
```

La logique est interne au composant, c'est mal ğŸ™„.

---

# `useReducer` Ã  la rescousse !

<iframe
  src="https://giphy.com/embed/l0HlTPnnfzRsf4f2U"
  width="480"
  height="270"
  frameBorder="0"
  allowFullScreen
/>

---

## MÃªme exemple avec `useReducer`

```js
// Le reducer est une simple fonction testable
function reducer(count, action) {
  switch (action.type) {
    case 'increment':
      return count + 1
    case 'decrement':
      return count - 1
    default:
      throw new Error('Unsupported action')
  }
}

function Example() {
  const [count, dispatch] = useReducer(reducer)

  // Le composant se contente d'Ã©mettre des actions
  return (
    <div>
      <button onClick={() => dispatch({ type: 'increment' })}>Increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>Decrement</button>
    </div>
  )
}
```

---

## Ã€ retenir

> ğŸ‘‰ Gestion du state centralisÃ©e

> ğŸ‘‰ Le reducer est testable

> ğŸ‘‰ Le code des composants est plus clair

---

<Exercise num={7} title="Advanced State" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/209/square_480/React_Dnd_Final.png" />
  <Title.Text>Scalable Components</Title.Text>
</Title>

---

## Styled Components

<Iframe src="https://codesandbox.io/embed/2vpm40qk90?autoresize=1&fontsize=14&hidenavigation=1" />

---

## Styled Components

- Le style fait parti du composant
- Le style change en fonction des props
- Du vrai CSS !

---

## Comment crÃ©er un composant Card ?

---

import Card from './components/Card'

## Ce que je veux obtenir

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## Je crÃ©e mon composant !

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      <CardHeader>{title}</CardHeader>
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

```js
<Card title="Hello!" text="I am Card" />
```

---

# Ã‡a marche !

---

# A new product owner is coming!

<iframe
  src="https://giphy.com/embed/Cmr1OMJ2FN0B2"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# â€œTu peux enlever le titre ?â€

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## â€œOK, pas de soucis !â€

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, text }) {
  return (
    <div>
      {title && <CardHeader>{title}</CardHeader>}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

# A UX designer is coming!

<iframe
  src="https://giphy.com/embed/3ornk57KwDXf81rjWM"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# â€œLe titre sur un fond vert est plus parlant.â€

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## â€œOK, je pense que je peux le faire.â€

```js
const CardHeader = styled.div``
const CardBody = styled.div``

function Card({ title, titleBackgroundColor, text }) {
  return (
    <div>
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<h1>A new marketing manager<br/> appears!</h1>

<iframe
  src="https://giphy.com/embed/t98sHJAJ69MCoMoXAr"
  width="480"
  height="431"
  frameBorder="0"
  allowFullScreen
/>

---

# â€œTu peux mettre une barre de pub Ã  la place du header ?â€

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    ğŸ‘» -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a Card</Card.Body>
</Card>

---

## â€œEuh...â€

```js
const CardHeader = styled.div``
const CardBody = styled.div``
const CardAd = styled.div``

function Card({ title, titleBackgroundColor, ad, text }) {
  return (
    <div>
      {ad && <CardAd>{ad}</CardAd>}
      {title && (
        <CardHeader style={{ backgroundColor: titleBackgroundColor }}>
          {title}
        </CardHeader>
      )}
      <CardBody>{text}</CardBody>
    </div>
  )
}
```

---

<iframe
  src="https://giphy.com/embed/46itMIe0bkQeY"
  width="480"
  height="267"
  frameBorder="0"
  allowFullScreen
/>

---

# Et si on avait fait autrement ? ğŸ¤”

---

```js
export const Card = styled.div``
Card.Body = styled.div``
Card.Header = styled.div``
```

---

# Les choses auraient Ã©tÃ© bien diffÃ©rentes... ğŸ˜Œ

---

<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <Card.Header>Hello!</Card.Header>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>

```js
<Card>
  <Card.Header style={{ backgroundColor: 'green' }}>Hello</Card.Header>
  <Card.Body>I am a Card</Card.Body>
</Card>
```

---

<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    ğŸ‘» -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>

```js
<Card>
  <div
    style={{
      padding: 5,
      backgroundColor: 'black',
      color: 'white',
      fontSize: 14,
    }}
  >
    ğŸ‘» -50% on all articles, happy halloween!
  </div>
  <Card.Body>I am a card</Card.Body>
</Card>
```

---

## Ã€ retenir

> ğŸ‘‰ Pensez aux "children"

> ğŸ‘‰ Un composant par Ã©lÃ©ment DOM

---

<Exercise num={8} title="Scalable Components" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/262/full/EGH_ReactContext_Final.png" />
  <Title.Text>Context</Title.Text>
</Title>

---

## Le contexte c'est quoi ?

<img src="https://cdn-images-1.medium.com/max/1600/0*u0M1gjQG7Lxa2uww" />

---

## Exemple

```js
import React, { createContext, useContext } from 'react'

// On crÃ©e un `ThemeContext` avec pour valeur par dÃ©faut "white"
const ThemeContext = createContext('white')

function Button({ children }) {
  // On rÃ©cupÃ¨re la valeur injectÃ© dans le contexte avec `useContext`
  const theme = useContext(ThemeContext)
  return <button style={{ color: theme }}>{children}</button>
}

function App() {
  // Le `Context.Provider` permet d'injecter une valeur dans `ThemeContext`
  // Tous les enfants ont alors accÃ¨s Ã  cette valeur
  return (
    <ThemeContext.Provider value="black">
      <Button>Hello</Button>
    </ThemeContext.Provider>
  )
}
```

---

## Que se passe-t-il ?

- Le `Provider` subit un mount/update
- La valeur injectÃ©e est-elle diffÃ©rente ?
  - Oui â†’ les `Consumer` sont re-rendus
  - Non â†’ rien ne se passe

---

## Contexte riche

```js
function ThemeProvider({ color, font }) {
  // L'objet `value` est nouveau Ã  chaque rendu
  // `ThemeContext` notifie donc ses "consumers" Ã  chaque rendu
  const value = { color, font }
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## `useMemo`

```js
function ThemeProvider({ theme }) {
  // `useMemo` mÃ©morise le rÃ©sultat de la fonction tant que les dÃ©pendances ne changent pas
  // Tant que `theme` n'a pas changÃ©, on aura le mÃªme objet `value`
  const value = useMemo(() => ({ theme }), [theme])
  return (
    <ThemeContext.Provider value={value}>
      <App />
    </ThemeContext.Provider>
  )
}
```

---

## Contexte dynamique

```js
function ThemeProvider({ defaultTheme, children }) {
  // Un `state` contient le `theme`
  const [theme, setTheme] = useState(defaultTheme)
  // On injecte la fonction `setTheme` dans le contexte
  const value = useMemo(() => ({ theme, setTheme }), [theme, setTheme])
  return <ThemeContext.Provider value={value}>{children}</ThemeContext.Provider>
}

// in another file...

function ThemeSwitcher() {
  const { theme, setTheme } = useContext(ThemeContext)
  return (
    <button
      onClick={() => setTheme(theme => (theme === 'dark' ? 'light' : 'dark'))}
    >
      Switch theme {theme}
    </button>
  )
}
```

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/025/square_480/EGH_Redux-New.png" />
  <Title.Text>Redux</Title.Text>
</Title>

---

## Qu'est-ce que Redux ?

- Communication entre les composants
- State modifiÃ© par un reducer
- Connect / Dispatch

---

## C'est dÃ©jÃ  dans React !

- `createContext`
- `useReducer`
- `useContext`

---

```js
// redux.js
import React, { createContext, useReducer, useContext } from 'react'

const ReduxContext = createContext()

export function ReduxProvider({ reducer, initialState, children }) {
  // On crÃ© un reducer
  const [state, dispatch] = useReducer(reducer, initialState)
  // On injecte le state et la fonction dispatch
  const value = useMemo(() => ({ state, dispatch }), [state, dispatch])
  return <ReduxContext.Provider value={value}>{children}</ReduxContext.Provider>
}

export function useRedux() {
  return useContext(ReduxContext)
}

// App.js
import React from 'react'
import { ReduxProvider } from './redux'
import { reducer, initialState } from './reducer'

export default function App() {
  return (
    <ReduxProvider reducer={reducer} initialState={initialState}>
      <>
        {/* ... */}
        <RegisterButton />
      </>
    </ReduxProvider>
  )
}

// RegisterButton.js
import React from 'react'
import { useRedux } from './redux'

function RegisterButton() {
  const { dispatch } = useContext(ReduxContext)

  return (
    <button onClick={() => dispatch({ type: 'register' })}>Register</button>
  )
}
```

---

<Exercise num={9} title="Internationalization" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/058/square_480/EGH_Mobx_Final.png" />
  <Title.Text>Interaction avec le DOM</Title.Text>
</Title>

---

## Component Refs

```js
function Example() {
  // `ref.current` sera la rÃ©fÃ©rence vers l'Ã©lÃ©ment une fois le composant montÃ©
  const ref = useRef()
  return <input type="text" ref={ref} />
}
```

---

## Forward Ref

```js
const FancyInput = React.forwardRef((props, ref) => (
  <input ref={ref} className="FancyInput" />
))

function Example() {
  // `ref.current` sera la rÃ©fÃ©rence Ã  l'Ã©lÃ©ment DOM button
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

```js
const FancyInput = forwardRef((props, ref) => {
  const inputRef = useRef()

  useImperativeHandle(ref, () => ({
    focus: () => {
      inputRef.current.focus()
    },
  }))

  return <input ref={inputRef} className="FancyInput" />
})

function Example() {
  // `ref.current.focus()` fonctionnera
  const ref = useRef()
  return <FancyInput ref={ref} />
}
```

---

## `useImperativeHandle`

- Permet de customiser lâ€™instance gÃ©nÃ©rÃ©e par `useRef`
- A nâ€™utiliser quâ€™avec `forwardRef`

---

<Exercise num={10} title="Autofocus" />

---

<Title>
  <Title.Picture src="https://d2eip9sf3oo6c2.cloudfront.net/series/square_covers/000/000/198/square_480/EGH_TestReactJest-edited.png" />
  <Title.Text>Effects in depth</Title.Text>
</Title>

---

## `useEffect` ne marche pas !

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

> useEffect capture les variables au montage

---

## C'Ã©tait pareil avant

<iframe
  src="https://codesandbox.io/embed/w2wxl3yo0l?fontsize=14"
  style={{ width: '100%', height: 500, border: 0, overflow: 'hidden' }}
  sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"
/>

---

# Comment faire ?

---

# 1. SpÃ©cifier les dÃ©pendances

---

## Avec dÃ©pendances

```js
function Example() {
  const [count, setCount] = useState(0)
  useEffect(() => {
    const interval = setInterval(() => console.log(count), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

# 2. `useRef` Ã  la rescousse !

---

## Avec `useRef`

```js
function Example() {
  const [count, setCount] = useState(0)
  const countRef = useRef()
  countRef.current = count
  useEffect(() => {
    const interval = setInterval(() => console.log(countRef.current), 100)
    return () => clearInterval(interval)
  }, [count])
  return <button onClick={() => setCount(count => count + 1)}>Increment</button>
}
```

---

## Qu'est-ce que le `useRef` ?

- Un objet unique Ã  votre instance de composant
- Un moyen de stocker des valeurs sans dÃ©clencher un update

---

## Utilisation

```js
const ref = useRef(/* initial value */)
ref.current // Access ref value using `ref.current`
```

---

<Exercise num={11} title="Keyboard Shortcuts" />

---

# Thanks!

> â¤ï¸ J'ai aimÃ©, [je poste une avis !](https://www.google.fr/maps/place/Smooth+Code/@48.8657415,2.3519553,17z/data=!3m1!4b1!4m5!3m4!1s0x47e66e1a846e6f39:0x3140a381af8bfb56!8m2!3d48.865738!4d2.354144?hl=en)

> ğŸ™„ Je j'ai pas aimÃ©, je ne fais rien !
